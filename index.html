import pandas as pd
import json
from datetime import date

# Load Excel
df = pd.read_excel("towns.xlsx")

# Select and rename columns if needed
columns_to_keep = [
    "Name",
    "Alternative_Names",
    "Country",
    "Type",
    "List_Availability",
    "Progress",
    "Link",
    "Latitude",
    "Longitude"
]

# Filter only existing columns (in case some are missing)
df = df[[c for c in columns_to_keep if c in df.columns]]

# Replace NaN with empty string
df = df.fillna("")

# Convert to list of dicts
towns = df.to_dict(orient="records")

# Save JSON
with open("data/towns.json", "w", encoding="utf-8") as f:
    json.dump(towns, f, indent=2, ensure_ascii=False)

# Update metadata.json with last_updated date
metadata = {
    "last_updated": date.today().isoformat()
}
with open("data/metadata.json", "w", encoding="utf-8") as f:
    json.dump(metadata, f, indent=2)